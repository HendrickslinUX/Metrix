<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Metrix HardLine â€” User Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* ====== Base Styles ====== */
    body { font-family: 'DM Sans', sans-serif; background: #f8f9fa; margin:0; padding:0; color:#0b0b0b; }
    header { background:#0b0b0b; color:white; padding:1rem; display:flex; justify-content:space-between; align-items:center; }
    header h1 { font-size:1.4rem; margin:0; }
    header button { background:#ff4b5c; color:white; border:none; padding:.5rem 1rem; border-radius:5px; cursor:pointer; }
    main { padding:1rem; }
    h2 { margin-top:0; }

    /* ====== Stats ====== */
    .stats { display:flex; gap:1rem; margin-bottom:2rem; flex-wrap:wrap; }
    .stat-card { flex:1; min-width:120px; background:white; padding:1rem; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); text-align:center; }
    .stat-card h3 { margin-bottom:.5rem; }

    /* ====== Calendar ====== */
    .calendar { display:grid; grid-template-columns: repeat(7,1fr); gap:2px; margin-bottom:2rem; }
    .day { min-height:80px; background:white; border-radius:5px; padding:.2rem; display:flex; flex-direction:column; }
    .day-header { font-weight:bold; font-size:.9rem; margin-bottom:.2rem; }
    .task { padding:.2rem .4rem; margin-bottom:.2rem; border-radius:5px; color:white; font-size:.8rem; cursor:pointer; }
    .Softy { background:#6c757d; }
    .GrindMode { background:#ff9800; }
    .HardLine { background:#d32f2f; }

    /* ====== Task Form ====== */
    .task-form { margin-bottom:2rem; background:white; padding:1rem; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    .task-form input, .task-form select, .task-form button { margin-top:.5rem; display:block; width:100%; padding:.5rem; border-radius:5px; border:1px solid #ccc; }
    .task-form button { background:#0d6efd; color:white; border:none; cursor:pointer; }

    /* ====== Modal Tooltip ====== */
    .tooltip { position:absolute; background:#0b0b0b; color:white; padding:.5rem; border-radius:5px; font-size:.8rem; display:none; z-index:1000; }
  </style>
</head>
<body>

<header>
  <h1>Metrix HardLine Dashboard</h1>
  <button id="logoutBtn">Logout</button>
</header>

<main>
  <section class="stats">
    <div class="stat-card"><h3>Total Tasks</h3><p id="totalTasks">0</p></div>
    <div class="stat-card"><h3>Completed Tasks</h3><p id="completedTasks">0</p></div>
    <div class="stat-card"><h3>Missed Tasks</h3><p id="missedTasks">0</p></div>
    <div class="stat-card"><h3>Current Streak</h3><p id="currentStreak">0</p></div>
    <div class="stat-card"><h3>Longest Streak</h3><p id="longestStreak">0</p></div>
  </section>

  <section class="task-form">
    <h2>Create Task</h2>
    <input type="text" id="taskTitle" placeholder="Task Title" required>
    <input type="date" id="taskDeadline" required>
    <select id="taskIntensity">
      <option value="Softy">Softy (Easy)</option>
      <option value="GrindMode">GrindMode (Medium)</option>
      <option value="HardLine">HardLine (Hard)</option>
    </select>
    <button id="addTaskBtn">Add Task</button>
  </section>

  <section class="calendar" id="calendar"></section>

  <div class="tooltip" id="tooltip"></div>
</main>

<script>
  // ====== Setup ======
  const logoutBtn = document.getElementById('logoutBtn');
  const addTaskBtn = document.getElementById('addTaskBtn');
  const taskTitle = document.getElementById('taskTitle');
  const taskDeadline = document.getElementById('taskDeadline');
  const taskIntensity = document.getElementById('taskIntensity');
  const calendar = document.getElementById('calendar');
  const tooltip = document.getElementById('tooltip');

  let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
  let stats = { total:0, completed:0, missed:0, currentStreak:0, longestStreak:0 };

  logoutBtn.addEventListener('click', ()=>{ window.location.href='userlogin.html'; });

  // ====== Helper Functions ======
  function updateStats() {
    const today = new Date().toISOString().split('T')[0];
    stats.total = tasks.length;
    stats.completed = tasks.filter(t=>t.completed).length;
    stats.missed = tasks.filter(t=>!t.completed && t.deadline<today).length;
    stats.currentStreak = calculateStreak(tasks);
    stats.longestStreak = Math.max(stats.longestStreak, stats.currentStreak);

    document.getElementById('totalTasks').textContent = stats.total;
    document.getElementById('completedTasks').textContent = stats.completed;
    document.getElementById('missedTasks').textContent = stats.missed;
    document.getElementById('currentStreak').textContent = stats.currentStreak;
    document.getElementById('longestStreak').textContent = stats.longestStreak;
  }

  function calculateStreak(tasks){
    const sorted = [...tasks].sort((a,b)=>new Date(a.deadline)-new Date(b.deadline));
    let streak = 0, maxStreak=0;
    sorted.forEach(t=>{ if(t.completed) streak++; else streak=0; maxStreak=Math.max(maxStreak,streak); });
    return streak;
  }

  function renderCalendar() {
    calendar.innerHTML='';
    const start = new Date();
    start.setDate(1);
    const end = new Date();
    end.setMonth(start.getMonth()+12*3); // 3 year calendar

    let current = new Date(start);
    while(current <= end){
      const day = document.createElement('div');
      day.className='day';
      day.dataset.date = current.toISOString().split('T')[0];
      const header = document.createElement('div');
      header.className='day-header';
      header.textContent=current.toLocaleDateString(undefined,{day:'numeric',month:'short'});
      day.appendChild(header);
      tasks.filter(t=>t.deadline===day.dataset.date).forEach(t=>{
        const taskDiv=document.createElement('div');
        taskDiv.className=`task ${t.intensity}`;
        taskDiv.textContent=t.title;
        taskDiv.dataset.title=t.title;
        taskDiv.dataset.intensity=t.intensity;
        taskDiv.dataset.deadline=t.deadline;
        taskDiv.addEventListener('click', e=>{
          t.completed = !t.completed;
          localStorage.setItem('tasks',JSON.stringify(tasks));
          updateStats();
          renderCalendar();
          showTooltip(t,e);
        });
        day.appendChild(taskDiv);
      });
      calendar.appendChild(day);
      current.setDate(current.getDate()+1);
    }
  }

  function showTooltip(task,e){
    const messages = {
      Softy:['Keep going, you got this!','Small steps count.','Do what you can, stay consistent.'],
      GrindMode:['Focus! Deadlines are serious.','Grind hard! Stay on track.','No excuses, complete it now!'],
      HardLine:['Absolute commitment required!','No negotiation, finish this task!','HardLine intensity: finish or face consequences!']
    };
    const arr=messages[task.intensity];
    tooltip.textContent=arr[Math.floor(Math.random()*arr.length)];
    tooltip.style.top=`${e.clientY+10}px`;
    tooltip.style.left=`${e.clientX+10}px`;
    tooltip.style.display='block';
    setTimeout(()=>tooltip.style.display='none',2000);
  }

  addTaskBtn.addEventListener('click',()=>{
    if(!taskTitle.value || !taskDeadline.value) return alert('Please fill all fields');
    tasks.push({ title:taskTitle.value, deadline:taskDeadline.value, intensity:taskIntensity.value, completed:false });
    localStorage.setItem('tasks',JSON.stringify(tasks));
    taskTitle.value=''; taskDeadline.value=''; taskIntensity.value='Softy';
    updateStats();
    renderCalendar();
  });

  // ====== Initialize ======
  updateStats();
  renderCalendar();
</script>
</body>
</html>
