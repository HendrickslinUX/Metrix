<main>

  <section class="stats">
    <div class="stat-card"><h3>Total Tasks</h3><p id="totalTasks">0</p></div>
    <div class="stat-card"><h3>Completed</h3><p id="completedTasks">0</p></div>
    <div class="stat-card"><h3>Missed</h3><p id="missedTasks">0</p></div>
  </section>

  <section class="task-form">
    <h2>Create Task</h2>

    <!-- Step 1: Task Name -->
    <input id="taskTitle" class="task-step active" placeholder="Task title" />

    <!-- Step 2: Deadline -->
    <input id="taskDeadline" class="task-step" type="date" />

    <!-- Step 3: Intensity -->
    <select id="taskIntensity" class="task-step">
      <option value="Softy">Softy</option>
      <option value="GrindMode">GrindMode</option>
      <option value="HardLine">HardLine</option>
    </select>

    <!-- Step 4: Add Task Button -->
    <button id="addTaskBtn" class="task-step">Add Task</button>
  </section>

  <div class="calendar-wrapper">
    <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">
      <button id="prevMonthBtn" style="background:var(--accent); color:black; border:none; border-radius:6px; padding:0.5rem;">&#8592; Previous</button>
      <button id="nextMonthBtn" style="background:var(--accent); color:black; border:none; border-radius:6px; padding:0.5rem;">Next &#8594;</button>
    </div>
    <section class="calendar" id="calendar"></section>
  </div>

</main>

<script>
  // ===== TASK STEP LOGIC =====
  const taskTitle = document.getElementById('taskTitle');
  const taskDeadline = document.getElementById('taskDeadline');
  const taskIntensity = document.getElementById('taskIntensity');
  const addTaskBtn = document.getElementById('addTaskBtn');
  const steps = [taskTitle, taskDeadline, taskIntensity, addTaskBtn];

  steps.forEach((el, i) => {
    if(i < steps.length - 1) {
      el.addEventListener('input', () => steps[i+1].classList.add('active'));
    }
  });

  // ===== TASKS & CALENDAR =====
  let tasks = [];
  let currentMonthOffset = 0;

  addTaskBtn.addEventListener('click', () => {
    if(!taskTitle.value || !taskDeadline.value) return alert("Fill all fields");

    tasks.push({
      title: taskTitle.value,
      deadline: taskDeadline.value,
      intensity: taskIntensity.value,
      completed: false
    });

    // Reset steps
    steps.forEach(el => el.classList.remove('active'));
    taskTitle.classList.add('active');
    taskTitle.value = '';
    taskDeadline.value = '';
    taskIntensity.value = 'Softy';

    renderCalendar();
    updateStats();
  });

  const calendar = document.getElementById('calendar');
  const prevMonthBtn = document.getElementById('prevMonthBtn');
  const nextMonthBtn = document.getElementById('nextMonthBtn');

  prevMonthBtn.addEventListener('click', () => { currentMonthOffset--; renderCalendar(); });
  nextMonthBtn.addEventListener('click', () => { currentMonthOffset++; renderCalendar(); });

  function renderCalendar() {
    calendar.innerHTML = '';
    const todayISO = new Date().toISOString().split("T")[0];

    let start = new Date();
    start.setMonth(start.getMonth() + currentMonthOffset);
    start.setDate(1);

    const daysInMonth = new Date(start.getFullYear(), start.getMonth() + 1, 0).getDate();

    for(let i=1;i<=daysInMonth;i++){
      const d = new Date(start.getFullYear(), start.getMonth(), i);
      const dateStr = d.toISOString().split("T")[0];

      const day = document.createElement('div');
      day.className = "day";

      if(dateStr === todayISO) day.classList.add('today');
      const overdue = tasks.filter(t=>!t.completed && t.deadline < todayISO && t.deadline === dateStr);
      if(overdue.length > 0) day.classList.add('overdue');

      day.innerHTML = `<div class="day-header">${dateStr}</div>`;

      tasks.filter(t => t.deadline === dateStr).forEach(t => {
        const el = document.createElement('div');
        el.className = `task ${t.intensity}`;
        el.textContent = t.title;
        el.onclick = () => {
          t.completed = !t.completed;
          renderCalendar();
          updateStats();
        };
        day.appendChild(el);
      });

      calendar.appendChild(day);
    }
  }

  function updateStats() {
    totalTasks.textContent = tasks.length;
    completedTasks.textContent = tasks.filter(t=>t.completed).length;
    missedTasks.textContent = tasks.filter(t=>!t.completed).length;
  }

  renderCalendar();
</script>


